<<<<<<< HEAD
# Acesso a bancos de dados climáticos

## Precipitação com o pacote hydroTSM

Tutorial do HydroTSM - http://goo.gl/9u1PO

Instalação

```{r eval=FALSE, include=T}
install.packages("hydroTSM")
```

Carregar o pacote

```{r}
library(hydroTSM)
```

Carregando dados diários de Precipitação da estação de Rondonópolis-MT, com dados de 01 de janeiro de 1980 a 31 de dezembro de 2013

```{r}
roo<-read.zoo("https://www.dropbox.com/s/j1v3euj51dztv3r/1980-2013_pp.csv?dl=1",sep=";", dec=".", head=T)
```

Selecionar somente 5 anos da serie

```{r}
x <- window(roo, start=as.Date("2009-01-01"))
```

Valores de Precipitação mensal
```{r}
( m <- daily2monthly(x, FUN=sum) )
```

Datas dos valores diários de "x"

```{r}
dates <- time(x)
```

Quantidade de anos em 'x' (necessário para cálculos)
```{r}
( nyears <- yip(from=start(x), to=end(x), out.type="nmbr" ) )
```

Análise exploratórios do dados

Resumo estatástico

```{r}
smry(x)
```

Usando a função  `hydroplot`, que (por padrão) representa 9 gráficos diferentes: gráficos de 3 ts, 3 gráficos de caixa e 3 histogramas com um resumo "x". Para este exemplo, somente plotagens diárias e mensais são produzidas e apenas os dados iniciados em 01 de janeiro de 2009 são plotados.

```{r}
hydroplot(x, var.type="Precipitation", main="em Rondonopolis",
          pfreq = "dma", from="2009-01-01")
```

Quantidade de dias com informação (não NA) por ano

```{r}
dwi(x)
```

Quantidade de dias com informação (não NA) por mês por ano
```{r}
dwi(x, out.unit="mpy")
```

Plotar os valores mensais de Precipitação para cada ano, para identificar meses secos / umidos.

```{r}
# Daily zoo to monthly zoo
m <- daily2monthly(x, FUN=sum, na.rm=TRUE)

# Creating a matrix with monthly values per year in each column
M <- matrix(m, ncol=12, byrow=TRUE)
colnames(M) <- month.abb
rownames(M) <- unique(format(time(m), "%Y"))

```

```{r}
# Plotting the monthly precipitation values
require(lattice)
## Loading required package: lattice
print(matrixplot(M, ColorRamp="Precipitation",
main="Precipitação mensal de Rondonópolis-MT (mm/mês)"))
```

### Análise anual dos dados

Valores anuais de Precipitação
```{r}
daily2annual(x, FUN=sum, na.rm=TRUE)
```

Precipitação Média anual
```{r}
mean( daily2annual(x, FUN=sum, na.rm=TRUE) )
```

Outra forma (mais útil para 'streamflows', onde FUN = *mean*): A função anual aplica FUN duas vezes sobre x: 

   - (i) primeiramente, sobre todos os elementos de x pertencentes ao mesmo ano, para obter os correspondentes valores anuais, e 
   - (ii) em segundo lugar, acima de todos os valores anuais de x obtidos anteriormente, a fim de obter um único valor anual.

```{r}
annualfunction(x, FUN=sum, na.rm=TRUE) / nyears
```

### Análise mensal dos dados - BOXPLOT

Mediana dos valores mensais na estação de Rondonópolis-MT. 

```{r}
monthlyfunction(m, FUN=median, na.rm=TRUE)
```

Vetor com as abreviaturas de três letras para os nomes dos meses
```{r}
cmonth <- format(time(m), "%b")
```

Criando fatores mensais ordenados
```{r}
months <- factor(cmonth, levels=unique(cmonth), ordered=TRUE)
```

Boxplot dos valores mensais
```{r}
boxplot( coredata(m) ~ months, 
         col="lightblue", 
         main="Precipitação mensal de Rondonpolis,MT",
        ylab="Precipitação (mm)", xlab="Mensal")

```

### Análise sazonal

Valores sazonais médios de Precipitação

```{r}
seasonalfunction(x, FUN=sum, na.rm=TRUE) / nyears
```

Extraindo os valores sazonais para cada ano

Dezembro, Janeiro e Fevereiro
```{r}
( DJF <- dm2seasonal(x, season="DJF", FUN=sum) )
```

Março, Abril e Maio
```{r}
( MAM <- dm2seasonal(m, season="MAM", FUN=sum) )
```

Junho, Julho e Agosto
```{r}
( JJA <- dm2seasonal(m, season="JJA", FUN=sum) )
```

Setembro, Outubro e Novembro
```{r}
( SON <- dm2seasonal(m, season="SON", FUN=sum) )
```

Plotar a evolução temporal dos valores da Precipitação sazonal

```{r eval=FALSE, include=T}
X11()
hydroplot(x, pfreq="seasonal", FUN=sum, stype="default")
```

### Alguns índices extremos

Etapas comuns para a análise desta serie:

Carregando dados diários de Precipitação da estação Rondonópolis-MT, com dados de 01/Jan/1980 a 31/Dez/2013.

```{r}
data(roo)
```

Selecionar a data inicial
```{r}
x <- window(roo, start=as.Date("1980-01-01"))
```

Plotar a série temporal selecionada
```{r}
hydroplot(x, ptype="ts", pfreq="o", var.unit="mm")
```


Contagem e plotagem do número de dias no período em que a Precipitação foi maior que 80 mm.

```{r}
( R10mm <- length( x[x>80] ) )
```

### Precipitaçao total chuva

Calculando a Precipitação total (acumulada) de 5 dias

```{r}
x.5max <- rollapply(data=x, width=5, FUN=sum, fill=NA, partial= TRUE,
align="center")

hydroplot(x.5max, ptype="ts+boxplot", pfreq="o", var.unit="mm")

```

Valor anual máximo de Precipitação total em 5 dias

```{r}
(x.5max.annual <- daily2annual(x.5max, FUN=max, na.rm=TRUE))
```

   - *Nota 1:* para este cálculo, é utilizada uma janela móvel centrada no dia atual. Se o usuário quiser Precipitação total de 5 dias acumulada nos 4 dias anteriores ao dia atual + a Precipitação no corrente dia, o usuário tem que modificar a janela móvel.

   - *Nota 2:* Para os dois primeiros e os últimos dois valores, a largura da janela é adaptada para ignorar valores a série temporal


## Referência


http://www.gis-blog.com/download-srtm-for-an-entire-country/

http://www.gis-blog.com/r-raster-data-acquisition/

https://cmerow.github.io/RDataScience/05_Raster.html#1_setup

https://ropensci.org/blog/2017/03/07/hddtools/
=======
# Acesso a bancos de dados climáticos

## Precipitação com o pacote hydroTSM

Tutorial do HydroTSM - http://goo.gl/9u1PO

Instalação

```{r eval=FALSE, include=T}
install.packages("hydroTSM")
```

Carregar o pacote

```{r}
library(hydroTSM)
```

Carregando dados diários de Precipitação da estação de Rondonópolis-MT, com dados de 01 de janeiro de 1980 a 31 de dezembro de 2013

```{r}
roo<-read.zoo("https://www.dropbox.com/s/j1v3euj51dztv3r/1980-2013_pp.csv?dl=1",sep=";", dec=".", head=T)
```

Selecionar somente 5 anos da serie

```{r}
x <- window(roo, start=as.Date("2009-01-01"))
```

Valores de Precipitação mensal
```{r}
( m <- daily2monthly(x, FUN=sum) )
```

Datas dos valores diários de "x"

```{r}
dates <- time(x)
```

Quantidade de anos em 'x' (necessário para cálculos)
```{r}
( nyears <- yip(from=start(x), to=end(x), out.type="nmbr" ) )
```

Análise exploratórios do dados

Resumo estatástico

```{r}
smry(x)
```

Usando a função  `hydroplot`, que (por padrão) representa 9 gráficos diferentes: gráficos de 3 ts, 3 gráficos de caixa e 3 histogramas com um resumo "x". Para este exemplo, somente plotagens diárias e mensais são produzidas e apenas os dados iniciados em 01 de janeiro de 2009 são plotados.

```{r}
hydroplot(x, var.type="Precipitation", main="em Rondonopolis",
          pfreq = "dma", from="2009-01-01")
```

Quantidade de dias com informação (não NA) por ano

```{r}
dwi(x)
```

Quantidade de dias com informação (não NA) por mês por ano
```{r}
dwi(x, out.unit="mpy")
```

Plotar os valores mensais de Precipitação para cada ano, para identificar meses secos / umidos.

```{r}
# Daily zoo to monthly zoo
m <- daily2monthly(x, FUN=sum, na.rm=TRUE)

# Creating a matrix with monthly values per year in each column
M <- matrix(m, ncol=12, byrow=TRUE)
colnames(M) <- month.abb
rownames(M) <- unique(format(time(m), "%Y"))

```

```{r}
# Plotting the monthly precipitation values
require(lattice)
## Loading required package: lattice
print(matrixplot(M, ColorRamp="Precipitation",
main="Precipitação mensal de Rondonópolis-MT (mm/mês)"))
```

### Análise anual dos dados

Valores anuais de Precipitação
```{r}
daily2annual(x, FUN=sum, na.rm=TRUE)
```

Precipitação Média anual
```{r}
mean( daily2annual(x, FUN=sum, na.rm=TRUE) )
```

Outra forma (mais útil para 'streamflows', onde FUN = *mean*): A função anual aplica FUN duas vezes sobre x: 

   - (i) primeiramente, sobre todos os elementos de x pertencentes ao mesmo ano, para obter os correspondentes valores anuais, e 
   - (ii) em segundo lugar, acima de todos os valores anuais de x obtidos anteriormente, a fim de obter um único valor anual.

```{r}
annualfunction(x, FUN=sum, na.rm=TRUE) / nyears
```

### Análise mensal dos dados - BOXPLOT

Mediana dos valores mensais na estação de Rondonópolis-MT. 

```{r}
monthlyfunction(m, FUN=median, na.rm=TRUE)
```

Vetor com as abreviaturas de três letras para os nomes dos meses
```{r}
cmonth <- format(time(m), "%b")
```

Criando fatores mensais ordenados
```{r}
months <- factor(cmonth, levels=unique(cmonth), ordered=TRUE)
```

Boxplot dos valores mensais
```{r}
boxplot( coredata(m) ~ months, 
         col="lightblue", 
         main="Precipitação mensal de Rondonpolis,MT",
        ylab="Precipitação (mm)", xlab="Mensal")

```

### Análise sazonal

Valores sazonais médios de Precipitação

```{r}
seasonalfunction(x, FUN=sum, na.rm=TRUE) / nyears
```

Extraindo os valores sazonais para cada ano

Dezembro, Janeiro e Fevereiro
```{r}
( DJF <- dm2seasonal(x, season="DJF", FUN=sum) )
```

Março, Abril e Maio
```{r}
( MAM <- dm2seasonal(m, season="MAM", FUN=sum) )
```

Junho, Julho e Agosto
```{r}
( JJA <- dm2seasonal(m, season="JJA", FUN=sum) )
```

Setembro, Outubro e Novembro
```{r}
( SON <- dm2seasonal(m, season="SON", FUN=sum) )
```

Plotar a evolução temporal dos valores da Precipitação sazonal

```{r eval=FALSE, include=T}
X11()
hydroplot(x, pfreq="seasonal", FUN=sum, stype="default")
```

### Alguns índices extremos

Etapas comuns para a análise desta serie:

Carregando dados diários de Precipitação da estação Rondonópolis-MT, com dados de 01/Jan/1980 a 31/Dez/2013.

```{r}
data(roo)
```

Selecionar a data inicial
```{r}
x <- window(roo, start=as.Date("1980-01-01"))
```

Plotar a série temporal selecionada
```{r}
hydroplot(x, ptype="ts", pfreq="o", var.unit="mm")
```


Contagem e plotagem do número de dias no período em que a Precipitação foi maior que 80 mm.

```{r}
( R10mm <- length( x[x>80] ) )
```

### Precipitaçao total chuva

Calculando a Precipitação total (acumulada) de 5 dias

```{r}
x.5max <- rollapply(data=x, width=5, FUN=sum, fill=NA, partial= TRUE,
align="center")

hydroplot(x.5max, ptype="ts+boxplot", pfreq="o", var.unit="mm")

```

Valor anual máximo de Precipitação total em 5 dias

```{r}
(x.5max.annual <- daily2annual(x.5max, FUN=max, na.rm=TRUE))
```

   - *Nota 1:* para este cálculo, é utilizada uma janela móvel centrada no dia atual. Se o usuário quiser Precipitação total de 5 dias acumulada nos 4 dias anteriores ao dia atual + a Precipitação no corrente dia, o usuário tem que modificar a janela móvel.

   - *Nota 2:* Para os dois primeiros e os últimos dois valores, a largura da janela é adaptada para ignorar valores a série temporal


## Referência


http://www.gis-blog.com/download-srtm-for-an-entire-country/

http://www.gis-blog.com/r-raster-data-acquisition/

https://cmerow.github.io/RDataScience/05_Raster.html#1_setup

https://ropensci.org/blog/2017/03/07/hddtools/
>>>>>>> origin
